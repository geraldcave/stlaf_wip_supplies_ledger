<div class="container mt-4">

        <?php if (isset($saved) && $saved === true): ?>
            <div class="alert alert-success">✅ Stock Out Recorded</div>
        <?php elseif (isset($saved) && $saved === -1): ?>
            <div class="alert alert-warning">⚠️ Not enough stock available!</div>
        <?php elseif (isset($saved) && !$saved): ?>
            <div class="alert alert-danger">❌ Failed to record stock out.</div>
        <?php endif; ?>

        <div class="card shadow p-4 border-0">
            <h4 class="fw-bold">Stock Out Form</h4>

            <form method="POST">
                <div class="mb-3">
                    <label class="form-label fw-bold">Select Item</label>
                    <select name="item_id" class="form-select" required>
                        <option value="">-- Select Item --</option>
                        <?php while ($i = $items->fetch_assoc()): ?>
                            <option value="<?= $i['id'] ?>">
                                <?= $i['description'] ?> (On Hand: <?= $i['qty_on_hand'] ?> <?= $i['unit'] ?>)
                            </option>
                        <?php endwhile; ?>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Quantity Out</label>
                    <input type="number" name="qty_out" min="1" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Remarks</label>
                    <input type="text" name="remarks" class="form-control">
                </div>

                <button class="btn btn-danger w-100 fw-bold">Save Stock Out</button>
            </form>
        </div>
    </div>

    <?php
session_start();
require_once '../../sql/config.php';
require_once 'logics/stock_out.php';

if (!isset($_SESSION['user_id']) || strtolower($_SESSION['department']) !== 'admin') {
    header('Location: ' . BASE_URL . 'index.php');
    exit();
}

$db = new Database();
$conn = $db->getConnection();
$stock = new StockOut($conn);

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $saved = $stock->addStockOut($_POST['item_id'], $_POST['qty_out'], $_POST['remarks']);
}

$items = $stock->getItems();
?>